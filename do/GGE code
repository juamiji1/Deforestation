//TOPIC: This code calculates the yearly forest loss in Colombia between (2000-2018).
//API: The code is in JS and must be run in https://code.earthengine.google.com/


// Importing the municipalities geometry
var  muni = ee.FeatureCollection('users/juamiji/municipios');
//Map.addLayer( munis, {}, 'default display');

// Load and filter the Hansen data
var hansen = ee.Image('UMD/hansen/global_forest_change_2018_v1_6').select(['treecover2000','loss','gain','lossyear']);

// Scale into a var
var scale = hansen.projection().nominalScale()

// ------------2000:
var lossband = hansen.select(['lossyear']).eq(0);

// Converting to m2
var lossm2 = lossband.multiply(ee.Image.pixelArea());

// Function that adds the loss as a new property of each feature
var addVar= function(feature) {

  // Summing all loss at each feature level
    var lossSum = lossm2.reduceRegion({
    reducer: ee.Reducer.sum(),
    geometry: feature.geometry(),
    scale: scale,
    maxPixels : 1e9
  });

  return feature.set({loss: lossSum.get('lossyear')});
};

// Applying to geometry feature
var final = muni.map(addVar);

// Exporting the table as a CSV
Export.table.toDrive({
  collection: final,
  description: 'deforest2000',
  fileFormat: 'CSV'
});

// ------------2001:
var lossband = hansen.select(['lossyear']).eq(1);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2001',
  fileFormat: 'CSV'
});

// ------------2002:
var lossband = hansen.select(['lossyear']).eq(2);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2002',
  fileFormat: 'CSV'
});

// ------------2003:
var lossband = hansen.select(['lossyear']).eq(3);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2003',
  fileFormat: 'CSV'
});

// ------------2004:
var lossband = hansen.select(['lossyear']).eq(4);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2004',
  fileFormat: 'CSV'
});

// ------------2005:
var lossband = hansen.select(['lossyear']).eq(5);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2005',
  fileFormat: 'CSV'
});

// ------------2006:
var lossband = hansen.select(['lossyear']).eq(6);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2006',
  fileFormat: 'CSV'
});

// ------------2007:
var lossband = hansen.select(['lossyear']).eq(7);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2007',
  fileFormat: 'CSV'
});

// ------------2008:
var lossband = hansen.select(['lossyear']).eq(8);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2008',
  fileFormat: 'CSV'
});

// ------------2009:
var lossband = hansen.select(['lossyear']).eq(9);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2009',
  fileFormat: 'CSV'
});

// ------------2010:
var lossband = hansen.select(['lossyear']).eq(10);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2010',
  fileFormat: 'CSV'
});

// ------------2011:
var lossband = hansen.select(['lossyear']).eq(11);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2011',
  fileFormat: 'CSV'
});

// ------------2012:
var lossband = hansen.select(['lossyear']).eq(12);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2012',
  fileFormat: 'CSV'
});

// ------------2013:
var lossband = hansen.select(['lossyear']).eq(13);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2013',
  fileFormat: 'CSV'
});

// ------------2014:
var lossband = hansen.select(['lossyear']).eq(14);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2014',
  fileFormat: 'CSV'
});

// ------------2015:
var lossband = hansen.select(['lossyear']).eq(15);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2015',
  fileFormat: 'CSV'
});

// ------------2016:
var lossband = hansen.select(['lossyear']).eq(16);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2016',
  fileFormat: 'CSV'
});

// ------------2017:
var lossband = hansen.select(['lossyear']).eq(17);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2017',
  fileFormat: 'CSV'
});

// ------------2018:
var lossband = hansen.select(['lossyear']).eq(18);
var lossm2 = lossband.multiply(ee.Image.pixelArea());

var final = muni.map(addVar);

Export.table.toDrive({
  collection: final,
  description: 'deforest2018',
  fileFormat: 'CSV'
});



// END
